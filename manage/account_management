// local state schema
assetid: uint64 // 0 if ALGO
energy: uint64 // total energy locked by A
speed: uint64 // speed of energy transfer from A to B
duration: uint64 // duration of call
B: byte // receiver of energy

// set env vars for terminal
export ALGORAND_DATA="$HOME/node/testnetdata"
export WALLET=test
export CODE_DIR=./code
export TXNS_DIR=./txns
export OWNER=YAVXHYBX7ILFZZ2PP5S5LAKU77R2NZOYBS2GBCNE3NMGS66Y44AOIA6BO4
export FEE=OU63ZTRQ52BLI4L2APIB42W4AVUSIA52CPOC662T5YKTGQ5XKCE5UMI5RE
export A=LKVLY3J72YUVFPPK344652Y7MQH6LADUTK7XZFW6S2WRRCJIFBY6LLPX2I
export B=RMKUQNJ7KGMRWANBQ3KNHEKWNI7EA7ESWV3DOB7XMTG7DMP3LPDCI4FUNI
export STATE=24029953
export ESCROW=6EU6EKDJFTHWQLRJS32DBYU5OL6WT4WXN7WNQHRIJAEYNBGUIJAZUIVJK4
export ASA=23828034
export LOCK_ALGO_FEE=4000
export LOCK_ASA_FEE=5000
export UNLOCK_FEE=1000
export ENERGY=100
export SPEED=2
export DURATION=5
export ENERGY_A=90
export ENERGY_FEE=1
export ENERGY_B=9

// start goal, create wallet and account
goal node start
goal node status
goal node end
goal wallet new $WALLET
kangaroo cool entry raw steak wage gap drive fringe opinion primary rebel sea amazing select satoshi test announce dry post real wheel word ability raven
goal account new -w $WALLET

// manage state dapp
goal app create --creator $OWNER --approval-prog $CODE_DIR/state_approvalprogram.teal --clear-prog $CODE_DIR/state_clearprogram.teal --global-byteslices 0 --global-ints 0 --local-byteslices 1 --local-ints 4 --extra-pages 0 --on-completion OptIn -w $WALLET
goal app optin --app-id $STATE --from $A -w $WALLET
goal app optin --app-id $STATE --from $B -w $WALLET
goal app update --app-id=$STATE --from=$OWNER --approval-prog $CODE_DIR/state_approvalprogram.teal --clear-prog $CODE_DIR/state_clearprogram.teal -w $WALLET

// manage stateless escrow account
goal clerk compile $CODE_DIR/escrow.teal -w $WALLET
goal clerk send --amount 1000000 --from $OWNER --to $ESCROW -w $WALLET

// manage ASA
// https://developer.algorand.org/docs/reference/cli/goal/asset/send/
goal asset create --creator $OWNER --total 1000000000 --unitname LOLTEST1 --decimals 0
goal asset send -a 0 --assetid $ASA -f $FEE -t $FEE
goal asset send -a 0 --assetid $ASA -f $A -t $A
goal asset send -a 0 --assetid $ASA -f $B -t $B
goal asset send -a 0 --assetid $ASA -f $ESCROW -t $ESCROW --out=$TXNS_DIR/optin.txn
goal clerk sign -i $CODE_DIR/optin.txn -p $CODE_DIR/escrow.teal -o $TXNS_DIR/optin.stxn
goal clerk rawsend -f $CODE_DIR/optin.stxn
goal asset send -a 1000 --assetid $ASA -f $OWNER -t $A

// check values
echo ASA $ASA
echo STATE $STATE
echo OWNER $OWNER
goal account balance -a $OWNER
goal account info -a $OWNER
echo FEE $FEE
goal account balance -a $FEE
goal account info -a $FEE
echo A $A
goal account balance -a $A
goal account info -a $A
echo B $B
goal account balance -a $B
goal account info -a $B
echo ESCROW $ESCROW
goal account balance -a $ESCROW
goal account info -a $ESCROW
goal app read --app-id=$STATE --local --from=$A

// debugging
goal clerk dryrun -t $TXNS_DIR/signout.txn
goal clerk dryrun -t $TXNS_DIR/signout.txn --dryrun-dump  -o $TXNS_DIR/dr.json
tealdbg debug $TXNS_DIR/state_approvalprogram.teal -d $TXNS_DIR/dr.msgp --group-index 0